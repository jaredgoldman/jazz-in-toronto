version: '3'
services:
    strapi:
        container_name: strapi
        build: .
        image: jit-cms:latest
        restart: unless-stopped
        environment:
            database_client: postgres
            database_name: jazzintoronto
            database_username: jazzintoronto
            database_password: password
            database_host: strapidb
            database_port: 5433
            database_ssl: 'false'
            JWT_SECRET: 12345678
            ADMIN_JWT_SECRET: adfasdfasdfasf
            APP_KEYS: local1,local2
            API_TOKEN_SALT: salt

        volumes:
            - ./config:/opt/app/config
            - ./src:/opt/app/src
            - ./package.json:/opt/package.json
            - ./yarn.lock:/opt/yarn.lock
            - ./.env:/opt/app/.env
            - ./public/uploads:/opt/app/public/uploads
        ports:
            - '1337:1337'
        networks:
            - strapi
        depends_on:
            - strapidb

    strapidb:
        container_name: strapidb
        platform: linux/amd64 #for platform error on apple m1 chips
        restart: unless-stopped
        image: postgres:12.0-alpine
        environment:
            postgres_user: jazzintoronto
            postgres_password: password
            postgres_db: jazzintoronto
        volumes:
            - strapi-data:/var/lib/postgresql/data/ #using a volume
            #- ./data:/var/lib/postgresql/data/ # if you want to use a bind folder
        networks:
            - strapi

volumes:
    strapi-data:

networks:
    strapi:
        name: strapi
        driver: bridge
