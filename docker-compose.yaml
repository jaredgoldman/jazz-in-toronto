version: '3'
services:
    strapi:
        container_name: strapi
        build: .
        image: jit-local-dev:latest
        restart: unless-stopped
        environment:
            JWT_SECRET: 12345678
            ADMIN_JWT_SECRET: adfasdfasdfasf
            APP_KEYS: local1,local2
            API_TOKEN_SALT: salt
            CLOUDINARY_NAME: dr0n9fnu1
            CLOUDINARY_KEY: 452721889473484
            CLOUDINARY_SECRET: XgTAQx1meJ2Vfd1OBbRk3rvcTXI
            DATABASE_URL: postgresql://jazzintoronto:password@strapidb:5433/jazzintoronto
        volumes:
            - ./src:/app/src
            - ./public:/app/public
        ports:
            - '1337:1337'
        networks:
            - strapi
        depends_on:
            - strapidb

    strapidb:
        container_name: strapidb
        platform: linux/amd64
        restart: unless-stopped
        image: postgres:12.0-alpine
        command: postgres -p 5433
        environment:
            POSTGRES_USER: jazzintoronto
            POSTGRES_PASSWORD: password
            POSTGRES_DB: jazzintoronto
        volumes:
            - strapi-data:/var/lib/postgresql/data/
        networks:
            - strapi
        ports:
            - 5433:5433

    jitdb:
        container_name: jitdb
        platform: linux/amd64
        restart: unless-stopped
        image: postgres:12.0-alpine
        environment:
            POSTGRES_USER: jazzintoronto
            POSTGRES_PASSWORD: password
            POSTGRES_DB: jazzintoronto
        volumes:
            - jitdb-data:/var/lib/postgresql/data/
        ports:
            - 5432:5432

volumes:
    strapidb:
    strapi-data:
    jitdb-data:

networks:
    strapi:
        name: strapi
        driver: bridge
